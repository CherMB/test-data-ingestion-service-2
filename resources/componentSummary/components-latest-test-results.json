{
    "widget": {
        "id": "cs11",
        "title": "Latest test results",
        "description": "",
        "content": [
            {
                "header": [],
                "section": [
                    {
                        "type": 14,
                        "show_legends": false,
                        "column_type": "latestTestResults",
                        "show_pagination": true,
                        "query_key": "summaryLatestTestResultsSection",
                        "spec_key": "summaryLatestTestResultsSectionSpec",
                        "post_process_function_name": "component latest test results section",
                        "title": "",
                        "info": null,
                        "data_type": 0,
                        "orientation": 0
                    }
                ],
                "footer": []
            }
        ],
        "pagination": false
    },
    "queries": {
        "summaryLatestTestResultsSection": {
            "alias": "cb_test_suites",
            "query": {
                "size": 0,
                "query": {
                    "bool": {
                        "filter": [
                            {
                                "range": {
                                    "run_start_time": {
                                        "gte": "{{.startDate}}",
                                        "lte": "{{.endDate}}",
                                        "format": "yyyy-MM-dd HH:mm:ss",
                                        "time_zone": "{{.timeZone}}"
                                    }
                                }
                            },
                            {
                                "term": {
                                    "org_id": "{{.orgId}}"
                                }
                            }
                        ]
                    }
                },
                "aggs": {
                    "workflows": {
                        "terms": {
                            "field": "automation_id",
                            "size": 10000
                        },
                        "aggs": {
                            "suites": {
                                "terms": {
                                    "field": "test_suite_name",
                                    "size": 10000
                                },
                                "aggs": {
                                    "latest_suite_doc": {
                                        "top_hits": {
                                            "sort": [
                                                {
                                                    "run_start_time": {
                                                        "order": "desc"
                                                    }
                                                }
                                            ],
                                            "size": 1,
                                            "script_fields": {
                                                "start_time_in_millis": {
                                                    "script": {
                                                        "source": "doc['start_time'].value.getMillis()"
                                                    }
                                                },
                                                "zoned_start_time": {
                                                    "script": {
                                                        "params": {
                                                            "timeZone": "{{.timeZone}}"
                                                        },
                                                        "source": "DateTimeFormatter formatter = DateTimeFormatter.ofPattern('yyyy/MM/dd HH:mm:ss').withZone(ZoneId.of(params.timeZone)); return formatter.format(doc['start_time'].value);"
                                                    }
                                                }
                                            },
                                            "_source": [
                                                "total",
                                                "run_id",
                                                "run_number",
                                                "passed",
                                                "failed",
                                                "skipped",
                                                "duration",
                                                "start_time",
                                                "automation_name",
                                                "source"
                                            ]
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}