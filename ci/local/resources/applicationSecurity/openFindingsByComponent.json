{
    "widget": {
        "id": "aso3",
        "title": "Components with most open findings",
        "description": "",
        "content": [
            {
                "header": [],
                "section": [
                    {
                        "type": 21,
                        "show_legends": false,
                        "color_scheme": [
                            {
                                "color0": "#D6582A",
                                "color1": "#D6582A"
                            },
                            {
                                "color0": "#D6582A",
                                "color1": "#D6582A"
                            },
                            {
                                "color0": "#DF6231",
                                "color1": "#DF6231"
                            },
                            {
                                "color0": "#E16E3D",
                                "color1": "#E16E3D"
                            },
                            {
                                "color0": "#E3794B",
                                "color1": "#E3794B"
                            },
                            {
                                "color0": "#E5855B",
                                "color1": "#E5855B"
                            },
                            {
                                "color0": "#E7926B",
                                "color1": "#E7926B"
                            },
                            {
                                "color0": "#E99E7B",
                                "color1": "#E99E7B"
                            },
                            {
                                "color0": "#ECAB8D",
                                "color1": "#E99E7B"
                            },
                            {
                                "color0": "#EFB89E",
                                "color1": "#EFB89E"
                            }
                        ],
                        "spec_key": "openFindingsByComponentSpec",
                        "title": "Number of findings",
                        "data_type": 0,
                        "orientation": 1,
                        "light_color_scheme": [
                            {
                                "color0": "#D6582A",
                                "color1": "#D6582A"
                            },
                            {
                                "color0": "#D6582A",
                                "color1": "#D6582A"
                            },
                            {
                                "color0": "#DF6231",
                                "color1": "#DF6231"
                            },
                            {
                                "color0": "#E16E3D",
                                "color1": "#E16E3D"
                            },
                            {
                                "color0": "#E3794B",
                                "color1": "#E3794B"
                            },
                            {
                                "color0": "#E5855B",
                                "color1": "#E5855B"
                            },
                            {
                                "color0": "#E7926B",
                                "color1": "#E7926B"
                            },
                            {
                                "color0": "#E99E7B",
                                "color1": "#E99E7B"
                            },
                            {
                                "color0": "#ECAB8D",
                                "color1": "#E99E7B"
                            },
                            {
                                "color0": "#EFB89E",
                                "color1": "#EFB89E"
                            }
                        ],
                        "post_process_function_name": "open findings by component"
                    }
                ],
                "footer": []
            }
        ]
    },
    "queries": {
        "openFindingsByComponent": {
            "alias": "cb_security_findings",
            "query": {
                "size": 0,
                "query": {
                    "bool": {
                        "filter": [
                            {
                                "term": {
                                    "org_id": "{{.orgId}}"
                                }
                            },
                            {
                                "term": {
                                    "environment_id": "{{.targetEnv}}"
                                }
                            },
                            {
                                "term": {
                                    "profile_group_type": "application_environment"
                                }
                            },
                            {
                                "terms": {
                                    "remediation_status": [
                                        "OPEN",
                                        "IN_PROGRESS"
                                    ]
                                }
                            },
                            {
                                "terms": {
                                    "severity": [
                                        "VERY_HIGH",
                                        "HIGH",
                                        "MEDIUM",
                                        "LOW"
                                    ]
                                }
                            },
                            {
                                "bool": {
                                    "should": [
                                        {
                                            "term": {
                                                "is_stale": false
                                            }
                                        },
                                        {
                                            "bool": {
                                                "must_not": {
                                                    "exists": {
                                                        "field": "is_stale"
                                                    }
                                                }
                                            }
                                        }
                                    ],
                                    "minimum_should_match": 1
                                }
                            }
                        ]
                    }
                },
                "aggs": {
                    "components": {
                        "terms": {
                            "field": "component_name",
                            "size": 10000
                        },
                        "aggs": {
                            "severities": {
                                "terms": {
                                    "field": "severity",
                                    "size": 10
                                },
                                "aggs": {
                                    "findings_by_each_severity": {
                                        "terms": {
                                            "script": "doc['finding_code'].value + '_' + doc['tracking_id'].value",
                                            "size": 10000
                                        }
                                    }
                                }
                            },
                            "categories": {
                                "terms": {
                                    "field": "category",
                                    "size": 10
                                },
                                "aggs": {
                                    "findings_by_each_category": {
                                        "terms": {
                                            "script": "doc['finding_code'].value + '_' + doc['tracking_id'].value",
                                            "size": 10000
                                        }
                                    }
                                }
                            },
                            "findings_by_each_component": {
                                "cardinality": {
                                    "script": "doc['finding_code'].value + '_' + doc['tracking_id'].value"
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}